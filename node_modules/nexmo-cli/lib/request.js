"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _readline = _interopRequireDefault(require("readline"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var Request =
/*#__PURE__*/
function () {
  function Request(config, client, response) {
    _classCallCheck(this, Request);

    this.config = config;
    this.client = client;
    this.response = response;
  } // Account


  _createClass(Request, [{
    key: "accountSetup",
    value: function accountSetup(key, secret, flags) {
      this._verifyCredentials(key, secret, this.response.accountSetup(this.config, key, secret, flags).bind(this.response));
    }
  }, {
    key: "_verifyCredentials",
    value: function _verifyCredentials(key, secret, callback) {
      var client = this.client.instanceWith(key, secret);
      client.account.checkBalance(callback);
    }
  }, {
    key: "accountInfo",
    value: function accountInfo() {
      this.response.accountInfo(this.client.instance());
    }
  }, {
    key: "accountKey",
    value: function accountKey() {
      this.response.accountKey(this.client.instance());
    }
  }, {
    key: "accountSecret",
    value: function accountSecret() {
      this.response.accountSecret(this.client.instance());
    }
  }, {
    key: "accountBalance",
    value: function accountBalance() {
      this.client.instance().account.checkBalance(this.response.accountBalance.bind(this.response));
    } // Pricing

  }, {
    key: "priceSms",
    value: function priceSms(number) {
      number = stripPlus(number);
      this.client.instance().number.getPhonePricing('sms', number, this.response.priceSms.bind(this.response));
    }
  }, {
    key: "priceVoice",
    value: function priceVoice(number) {
      number = stripPlus(number);
      this.client.instance().number.getPhonePricing('voice', number, this.response.priceVoice.bind(this.response));
    }
  }, {
    key: "priceCountry",
    value: function priceCountry(country_code) {
      this.client.instance().number.getPricing(country_code, this.response.priceCountry.bind(this.response));
    } // Numbers

  }, {
    key: "numbersList",
    value: function numbersList(flags) {
      var options = {
        size: 100
      };

      if (flags.page) {
        options.index = flags.page;
      }

      if (flags.size) {
        options.size = flags.size;
      }

      if (flags.pattern) {
        options.pattern = flags.pattern;
        options.search_pattern = 1;
        if (options.pattern[0] === '*') options.search_pattern = 2;
        if (options.pattern.slice(-1) === '*') options.search_pattern = 0;
      }

      this.client.instance().number.get(options, this.response.numbersList(flags).bind(this.response));
    }
  }, {
    key: "numberSearch",
    value: function numberSearch(country_code, flags) {
      country_code = country_code.toUpperCase();
      var options = {
        features: [],
        size: 100
      };

      if (flags.voice) {
        options.features.push('VOICE');
      }

      if (flags.sms) {
        options.features.push('SMS');
      }

      if (flags.page) {
        options.index = flags.page;
      }

      if (flags.size) {
        options.size = flags.size;
      }

      if (flags.pattern) {
        options.pattern = flags.pattern;
        options.search_pattern = 1;
        if (options.pattern[0] === '*') options.search_pattern = 2;
        if (options.pattern.slice(-1) === '*') options.search_pattern = 0;
      }

      this.client.instance().number.search(country_code, options, this.response.numberSearch(flags).bind(this.response));
    }
  }, {
    key: "numberBuy",
    value: function numberBuy(numberOrPattern, command) {
      if (command.country_code) {
        this.numberBuyFromSearch(command.country_code, numberOrPattern, command);
      } else {
        this.numberBuyFromNumber(numberOrPattern, command);
      }
    }
  }, {
    key: "numberBuyFromNumber",
    value: function numberBuyFromNumber(number, flags) {
      var _this = this;

      number = stripPlus(number);
      confirm("Buying ".concat(number, ". This operation will charge your account."), this.response.emitter, flags, function () {
        _this.getCountryCode(number, flags, function (country_code) {
          _this.client.instance().number.buy(country_code, number, _this.response.numberBuyFromNumber(number).bind(_this.response));
        });
      });
    }
  }, {
    key: "numberBuyFromSearch",
    value: function numberBuyFromSearch(country_code, pattern, flags) {
      var _this2 = this;

      var options = {
        features: ['VOICE']
      };

      if (pattern) {
        options.pattern = pattern;
        options.search_pattern = 1;
        if (pattern[0] === '*') options.search_pattern = 2;
        if (pattern.slice(-1) === '*') options.search_pattern = 0;
      }

      this.client.instance().number.search(country_code, options, this.response.numberBuyFromPattern(function (number) {
        _this2.numberBuyFromNumber(number, flags);
      }));
    }
  }, {
    key: "numberCancel",
    value: function numberCancel(number, flags) {
      var _this3 = this;

      confirm('This operation can not be reversed.', this.response.emitter, flags, function () {
        _this3.getCountryCode(number, flags, function (country_code) {
          _this3.client.instance().number.cancel(country_code, number, _this3.response.numberCancel(number).bind(_this3.response));
        });
      });
    } // Applications

  }, {
    key: "applicationsList",
    value: function applicationsList(flags) {
      var options = {
        page_size: 100
      };

      if (flags.page) {
        options.index = flags.page;
      }

      if (flags.size) {
        options.page_size = flags.size;
      }

      this.client.instance().app.get(options, this.response.applicationsList(flags).bind(this.response));
    }
  }, {
    key: "applicationCreate",
    value: function applicationCreate(name, answer_url, event_url, flags) {
      var options = {};

      if (flags.answer_method) {
        options.answer_method = flags.answer_method;
      }

      if (flags.event_method) {
        options.event_method = flags.event_method;
      }

      this.client.instance().app.create(name, flags.type, answer_url, event_url, options, this.response.applicationCreate(flags));
    }
  }, {
    key: "applicationShow",
    value: function applicationShow(app_id) {
      this.client.instance().app.get(app_id, this.response.applicationShow.bind(this.response));
    }
  }, {
    key: "applicationUpdate",
    value: function applicationUpdate(app_id, name, answer_url, event_url, flags) {
      var options = {};

      if (flags.answer_method) {
        options.answer_method = flags.answer_method;
      }

      if (flags.event_method) {
        options.event_method = flags.event_method;
      }

      this.client.instance().app.update(app_id, name, flags.type, answer_url, event_url, options, this.response.applicationUpdate.bind(this.response));
    }
  }, {
    key: "applicationDelete",
    value: function applicationDelete(app_id, flags) {
      var _this4 = this;

      return confirm('This operation can not be reversed.', this.response.emitter, flags, function () {
        _this4.client.instance().app.delete(app_id, _this4.response.applicationDelete.bind(_this4.response));
      });
    }
  }, {
    key: "applicationNumbers",
    value: function applicationNumbers(app_id, flags) {
      var options = {};

      if (flags.page) {
        options.index = flags.page;
      }

      if (flags.size) {
        options.size = flags.size;
      }

      this.client.instance().number.get(options, this.response.applicationNumbers(app_id, flags).bind(this.response));
    } // links

  }, {
    key: "linkApp",
    value: function linkApp(number, app_id, flags) {
      this._link(number, flags, null, 'app', app_id);
    }
  }, {
    key: "linkSms",
    value: function linkSms(number, callback_url, flags) {
      this._link(number, flags, callback_url, 'sms', null);
    }
  }, {
    key: "linkTel",
    value: function linkTel(number, other_number, flags) {
      this._link(number, flags, null, 'tel', other_number, flags.voice_status_callback);
    }
  }, {
    key: "linkSip",
    value: function linkSip(number, sip_uri, flags) {
      this._link(number, flags, null, 'sip', sip_uri, flags.voice_status_callback);
    }
  }, {
    key: "linkVxml",
    value: function linkVxml(number, calback_url, flags) {
      this._link(number, flags, null, 'vxml', calback_url, flags.voice_status_callback);
    }
  }, {
    key: "unlinkApp",
    value: function unlinkApp(number, flags) {
      this._link(number, flags);
    }
  }, {
    key: "unlinkSms",
    value: function unlinkSms(number, flags) {
      this._link(number, flags, '', 'sms');
    }
  }, {
    key: "unlinkTel",
    value: function unlinkTel(number, flags) {
      this._link(number, flags, null, 'tel');
    }
  }, {
    key: "unlinkSip",
    value: function unlinkSip(number, flags) {
      this._link(number, flags, null, 'sip');
    }
  }, {
    key: "unlinkVxml",
    value: function unlinkVxml(number, flags) {
      this._link(number, flags, null, 'vxml');
    }
  }, {
    key: "numberUpdate",
    value: function numberUpdate(number, flags) {
      var _this5 = this;

      number = stripPlus(number);
      this.getCountryCode(number, flags, function (country_code) {
        var options = {};
        if (flags.mo_http_url) options.moHttpUrl = flags.mo_http_url;
        if (flags.voice_callback_type) options.voiceCallbackType = flags.voice_callback_type;
        if (flags.voice_callback_value) options.voiceCallbackValue = flags.voice_callback_value;
        if (flags.voice_status_callback) options.voiceStatusCallback = flags.voice_status_callback;

        _this5.client.instance().number.update(country_code, number, options, _this5.response.numberUpdate.bind(_this5.response));
      });
    }
  }, {
    key: "_link",
    value: function _link(number, flags, mo_http_url, voice_callback_type, voice_callback_value, voice_status_callback) {
      var _this6 = this;

      if (flags == null) {
        flags = {};
      }

      number = stripPlus(number);
      this.getCountryCode(number, flags, function (country_code) {
        var options = {};

        if (voice_callback_type == 'sms') {
          options.moHttpUrl = mo_http_url;
        } else {
          if (voice_callback_type !== undefined) {
            options.voiceCallbackType = voice_callback_type;
            if (voice_callback_value) options.voiceCallbackValue = voice_callback_value;
            if (voice_status_callback) options.voiceStatusCallback = voice_status_callback;
          }
        }

        _this6.client.instance().number.update(country_code, number, options, _this6.response.numberUpdate.bind(_this6.response));
      });
    } // Insight

  }, {
    key: "insightBasic",
    value: function insightBasic(number) {
      number = stripPlus(number);
      this.client.instance().numberInsight.get({
        level: 'basic',
        number: number
      }, this.response.insightBasic.bind(this.response));
    }
  }, {
    key: "insightStandard",
    value: function insightStandard(number, flags) {
      var _this7 = this;

      number = stripPlus(number);
      confirm('This operation will charge your account.', this.response.emitter, flags, function () {
        _this7.client.instance().numberInsight.get({
          level: 'standard',
          number: number
        }, _this7.response.insightStandard.bind(_this7.response));
      });
    }
  }, {
    key: "insightAdvanced",
    value: function insightAdvanced(number, flags) {
      var _this8 = this;

      number = stripPlus(number);
      confirm('This operation will charge your account.', this.response.emitter, flags, function () {
        _this8.client.instance().numberInsight.get({
          level: 'advancedSync',
          number: number
        }, _this8.response.insightStandard.bind(_this8.response));
      });
    } // sending messages

  }, {
    key: "sendSms",
    value: function sendSms(to, text, flags) {
      var _this9 = this;

      confirm('This operation will charge your account.', this.response.emitter, flags, function () {
        _this9.client.instance().message.sendSms(flags.from, to, text.join(' '), _this9.response.sendSms.bind(_this9.response));
      });
    }
  }, {
    key: "generateJwt",
    value: function generateJwt(privateKey, claims, flags) {
      var token = null;
      var error = null;

      try {
        var fullClaims = {};

        if (flags.app_id) {
          fullClaims['application_id'] = flags.app_id;
        }

        claims.forEach(function (claim) {
          var nameValue = claim.split('=');

          if (nameValue.length !== 2) {
            throw new Error('All claims must be in the form `name=value`. Got: ' + nameValue);
          } // Using JSON.parse to cast 'exp' to number


          if (nameValue[0] === 'acl' || nameValue[0] === 'exp') {
            try {
              fullClaims[nameValue[0]] = JSON.parse(nameValue[1]);
            } catch (e) {
              fullClaims[nameValue[0]] = nameValue[1];
            }
          } else {
            fullClaims[nameValue[0]] = nameValue[1];
          }
        });
        token = this.client.definition().generateJwt(privateKey, fullClaims);
      } catch (ex) {
        error = ex;
      }

      this.response.generateJwt(error, token);
    }
  }, {
    key: "getCountryCode",
    value: function getCountryCode(number, flags, callback) {
      if (flags.country_code) {
        callback(flags.country_code);
      } else {
        this.client.instance().numberInsight.get({
          level: 'basic',
          number: number
        }, this.response.numberInsight(function (response) {
          callback(response.country_code);
        }));
      }
    }
  }]);

  return Request;
}();

var _default = Request; // private methods

exports.default = _default;

var confirm = function confirm(message, emitter, flags, callback) {
  if (flags.confirm) {
    callback();
  } else {
    var cli = _readline.default.createInterface(process.stdin, process.stdout);

    cli.question(message + '\n\nPlease type "confirm" to continue: ', function (answer) {
      if (answer.toString().trim() == 'confirm') {
        emitter.log(' ');
        callback();
      } else {
        process.exit(1);
      }

      cli.close();
      process.stdin.destroy();
    });
  }
};

var stripPlus = function stripPlus(number) {
  if (!number) {
    return number;
  }

  while (number.charAt(0) === '+') {
    number = number.substr(1);
  }

  return number;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXF1ZXN0LmpzIl0sIm5hbWVzIjpbIlJlcXVlc3QiLCJjb25maWciLCJjbGllbnQiLCJyZXNwb25zZSIsImtleSIsInNlY3JldCIsImZsYWdzIiwiX3ZlcmlmeUNyZWRlbnRpYWxzIiwiYWNjb3VudFNldHVwIiwiYmluZCIsImNhbGxiYWNrIiwiaW5zdGFuY2VXaXRoIiwiYWNjb3VudCIsImNoZWNrQmFsYW5jZSIsImFjY291bnRJbmZvIiwiaW5zdGFuY2UiLCJhY2NvdW50S2V5IiwiYWNjb3VudFNlY3JldCIsImFjY291bnRCYWxhbmNlIiwibnVtYmVyIiwic3RyaXBQbHVzIiwiZ2V0UGhvbmVQcmljaW5nIiwicHJpY2VTbXMiLCJwcmljZVZvaWNlIiwiY291bnRyeV9jb2RlIiwiZ2V0UHJpY2luZyIsInByaWNlQ291bnRyeSIsIm9wdGlvbnMiLCJzaXplIiwicGFnZSIsImluZGV4IiwicGF0dGVybiIsInNlYXJjaF9wYXR0ZXJuIiwic2xpY2UiLCJnZXQiLCJudW1iZXJzTGlzdCIsInRvVXBwZXJDYXNlIiwiZmVhdHVyZXMiLCJ2b2ljZSIsInB1c2giLCJzbXMiLCJzZWFyY2giLCJudW1iZXJTZWFyY2giLCJudW1iZXJPclBhdHRlcm4iLCJjb21tYW5kIiwibnVtYmVyQnV5RnJvbVNlYXJjaCIsIm51bWJlckJ1eUZyb21OdW1iZXIiLCJjb25maXJtIiwiZW1pdHRlciIsImdldENvdW50cnlDb2RlIiwiYnV5IiwibnVtYmVyQnV5RnJvbVBhdHRlcm4iLCJjYW5jZWwiLCJudW1iZXJDYW5jZWwiLCJwYWdlX3NpemUiLCJhcHAiLCJhcHBsaWNhdGlvbnNMaXN0IiwibmFtZSIsImFuc3dlcl91cmwiLCJldmVudF91cmwiLCJhbnN3ZXJfbWV0aG9kIiwiZXZlbnRfbWV0aG9kIiwiY3JlYXRlIiwidHlwZSIsImFwcGxpY2F0aW9uQ3JlYXRlIiwiYXBwX2lkIiwiYXBwbGljYXRpb25TaG93IiwidXBkYXRlIiwiYXBwbGljYXRpb25VcGRhdGUiLCJkZWxldGUiLCJhcHBsaWNhdGlvbkRlbGV0ZSIsImFwcGxpY2F0aW9uTnVtYmVycyIsIl9saW5rIiwiY2FsbGJhY2tfdXJsIiwib3RoZXJfbnVtYmVyIiwidm9pY2Vfc3RhdHVzX2NhbGxiYWNrIiwic2lwX3VyaSIsImNhbGJhY2tfdXJsIiwibW9faHR0cF91cmwiLCJtb0h0dHBVcmwiLCJ2b2ljZV9jYWxsYmFja190eXBlIiwidm9pY2VDYWxsYmFja1R5cGUiLCJ2b2ljZV9jYWxsYmFja192YWx1ZSIsInZvaWNlQ2FsbGJhY2tWYWx1ZSIsInZvaWNlU3RhdHVzQ2FsbGJhY2siLCJudW1iZXJVcGRhdGUiLCJ1bmRlZmluZWQiLCJudW1iZXJJbnNpZ2h0IiwibGV2ZWwiLCJpbnNpZ2h0QmFzaWMiLCJpbnNpZ2h0U3RhbmRhcmQiLCJ0byIsInRleHQiLCJtZXNzYWdlIiwic2VuZFNtcyIsImZyb20iLCJqb2luIiwicHJpdmF0ZUtleSIsImNsYWltcyIsInRva2VuIiwiZXJyb3IiLCJmdWxsQ2xhaW1zIiwiZm9yRWFjaCIsImNsYWltIiwibmFtZVZhbHVlIiwic3BsaXQiLCJsZW5ndGgiLCJFcnJvciIsIkpTT04iLCJwYXJzZSIsImUiLCJkZWZpbml0aW9uIiwiZ2VuZXJhdGVKd3QiLCJleCIsImNsaSIsInJlYWRsaW5lIiwiY3JlYXRlSW50ZXJmYWNlIiwicHJvY2VzcyIsInN0ZGluIiwic3Rkb3V0IiwicXVlc3Rpb24iLCJhbnN3ZXIiLCJ0b1N0cmluZyIsInRyaW0iLCJsb2ciLCJleGl0IiwiY2xvc2UiLCJkZXN0cm95IiwiY2hhckF0Iiwic3Vic3RyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7SUFFTUEsTzs7O0FBQ0osbUJBQVlDLE1BQVosRUFBb0JDLE1BQXBCLEVBQTRCQyxRQUE1QixFQUFzQztBQUFBOztBQUNwQyxTQUFLRixNQUFMLEdBQWNBLE1BQWQ7QUFDQSxTQUFLQyxNQUFMLEdBQWNBLE1BQWQ7QUFDQSxTQUFLQyxRQUFMLEdBQWdCQSxRQUFoQjtBQUNELEcsQ0FDRDs7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J3JlYWRsaW5lJztcblxuY2xhc3MgUmVxdWVzdCB7XG4gIGNvbnN0cnVjdG9yKGNvbmZpZywgY2xpZW50LCByZXNwb25zZSkge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMuY2xpZW50ID0gY2xpZW50O1xuICAgIHRoaXMucmVzcG9uc2UgPSByZXNwb25zZTtcbiAgfVxuICAvLyBBY2NvdW50XG5cbiAgYWNjb3VudFNldHVwKGtleSwgc2VjcmV0LCBmbGFncykge1xuICAgIHRoaXMuX3ZlcmlmeUNyZWRlbnRpYWxzKGtleSwgc2VjcmV0LCB0aGlzLnJlc3BvbnNlLmFjY291bnRTZXR1cCh0aGlzLmNvbmZpZywga2V5LCBzZWNyZXQsIGZsYWdzKS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgfVxuXG4gIF92ZXJpZnlDcmVkZW50aWFscyhrZXksIHNlY3JldCwgY2FsbGJhY2spIHtcbiAgICBjb25zdCBjbGllbnQgPSB0aGlzLmNsaWVudC5pbnN0YW5jZVdpdGgoa2V5LCBzZWNyZXQpO1xuICAgIGNsaWVudC5hY2NvdW50LmNoZWNrQmFsYW5jZShjYWxsYmFjayk7XG4gIH1cblxuICBhY2NvdW50SW5mbygpIHtcbiAgICB0aGlzLnJlc3BvbnNlLmFjY291bnRJbmZvKHRoaXMuY2xpZW50Lmluc3RhbmNlKCkpO1xuICB9XG5cbiAgYWNjb3VudEtleSgpIHtcbiAgICB0aGlzLnJlc3BvbnNlLmFjY291bnRLZXkodGhpcy5jbGllbnQuaW5zdGFuY2UoKSk7XG4gIH1cblxuICBhY2NvdW50U2VjcmV0KCkge1xuICAgIHRoaXMucmVzcG9uc2UuYWNjb3VudFNlY3JldCh0aGlzLmNsaWVudC5pbnN0YW5jZSgpKTtcbiAgfVxuXG4gIGFjY291bnRCYWxhbmNlKCkge1xuICAgIHRoaXMuY2xpZW50Lmluc3RhbmNlKCkuYWNjb3VudC5jaGVja0JhbGFuY2UodGhpcy5yZXNwb25zZS5hY2NvdW50QmFsYW5jZS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgfVxuXG4gIC8vIFByaWNpbmdcblxuICBwcmljZVNtcyhudW1iZXIpIHtcbiAgICBudW1iZXIgPSBzdHJpcFBsdXMobnVtYmVyKTtcbiAgICB0aGlzLmNsaWVudC5pbnN0YW5jZSgpLm51bWJlci5nZXRQaG9uZVByaWNpbmcoJ3NtcycsIG51bWJlciwgdGhpcy5yZXNwb25zZS5wcmljZVNtcy5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgfVxuXG4gIHByaWNlVm9pY2UobnVtYmVyKSB7XG4gICAgbnVtYmVyID0gc3RyaXBQbHVzKG51bWJlcik7XG4gICAgdGhpcy5jbGllbnQuaW5zdGFuY2UoKS5udW1iZXIuZ2V0UGhvbmVQcmljaW5nKCd2b2ljZScsIG51bWJlciwgdGhpcy5yZXNwb25zZS5wcmljZVZvaWNlLmJpbmQodGhpcy5yZXNwb25zZSkpO1xuICB9XG5cbiAgcHJpY2VDb3VudHJ5KGNvdW50cnlfY29kZSkge1xuICAgIHRoaXMuY2xpZW50Lmluc3RhbmNlKCkubnVtYmVyLmdldFByaWNpbmcoY291bnRyeV9jb2RlLCB0aGlzLnJlc3BvbnNlLnByaWNlQ291bnRyeS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgfVxuXG4gIC8vIE51bWJlcnNcblxuICBudW1iZXJzTGlzdChmbGFncykge1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7IHNpemU6IDEwMCB9O1xuICAgIGlmIChmbGFncy5wYWdlKSB7IG9wdGlvbnMuaW5kZXggPSBmbGFncy5wYWdlOyB9XG4gICAgaWYgKGZsYWdzLnNpemUpIHsgb3B0aW9ucy5zaXplID0gZmxhZ3Muc2l6ZTsgfVxuXG4gICAgaWYgKGZsYWdzLnBhdHRlcm4pIHtcbiAgICAgIG9wdGlvbnMucGF0dGVybiA9IGZsYWdzLnBhdHRlcm47XG4gICAgICBvcHRpb25zLnNlYXJjaF9wYXR0ZXJuID0gMTtcbiAgICAgIGlmIChvcHRpb25zLnBhdHRlcm5bMF0gPT09ICcqJykgb3B0aW9ucy5zZWFyY2hfcGF0dGVybiA9IDI7XG4gICAgICBpZiAob3B0aW9ucy5wYXR0ZXJuLnNsaWNlKC0xKSA9PT0gJyonKSBvcHRpb25zLnNlYXJjaF9wYXR0ZXJuID0gMDtcbiAgICB9XG5cbiAgICB0aGlzLmNsaWVudC5pbnN0YW5jZSgpLm51bWJlci5nZXQob3B0aW9ucywgdGhpcy5yZXNwb25zZS5udW1iZXJzTGlzdChmbGFncykuYmluZCh0aGlzLnJlc3BvbnNlKSk7XG4gIH1cblxuICBudW1iZXJTZWFyY2goY291bnRyeV9jb2RlLCBmbGFncykge1xuICAgIGNvdW50cnlfY29kZSA9IGNvdW50cnlfY29kZS50b1VwcGVyQ2FzZSgpO1xuXG4gICAgY29uc3Qgb3B0aW9ucyA9IHsgZmVhdHVyZXM6IFtdLCBzaXplOiAxMDAgfTtcbiAgICBpZiAoZmxhZ3Mudm9pY2UpIHsgb3B0aW9ucy5mZWF0dXJlcy5wdXNoKCdWT0lDRScpOyB9XG4gICAgaWYgKGZsYWdzLnNtcykgeyBvcHRpb25zLmZlYXR1cmVzLnB1c2goJ1NNUycpOyB9XG4gICAgaWYgKGZsYWdzLnBhZ2UpIHsgb3B0aW9ucy5pbmRleCA9IGZsYWdzLnBhZ2U7IH1cbiAgICBpZiAoZmxhZ3Muc2l6ZSkgeyBvcHRpb25zLnNpemUgPSBmbGFncy5zaXplOyB9XG5cbiAgICBpZiAoZmxhZ3MucGF0dGVybikge1xuICAgICAgb3B0aW9ucy5wYXR0ZXJuID0gZmxhZ3MucGF0dGVybjtcbiAgICAgIG9wdGlvbnMuc2VhcmNoX3BhdHRlcm4gPSAxO1xuICAgICAgaWYgKG9wdGlvbnMucGF0dGVyblswXSA9PT0gJyonKSBvcHRpb25zLnNlYXJjaF9wYXR0ZXJuID0gMjtcbiAgICAgIGlmIChvcHRpb25zLnBhdHRlcm4uc2xpY2UoLTEpID09PSAnKicpIG9wdGlvbnMuc2VhcmNoX3BhdHRlcm4gPSAwO1xuICAgIH1cblxuICAgIHRoaXMuY2xpZW50Lmluc3RhbmNlKCkubnVtYmVyLnNlYXJjaChjb3VudHJ5X2NvZGUsIG9wdGlvbnMsIHRoaXMucmVzcG9uc2UubnVtYmVyU2VhcmNoKGZsYWdzKS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgfVxuXG4gIG51bWJlckJ1eShudW1iZXJPclBhdHRlcm4sIGNvbW1hbmQpIHtcbiAgICBpZiAoY29tbWFuZC5jb3VudHJ5X2NvZGUpIHtcbiAgICAgIHRoaXMubnVtYmVyQnV5RnJvbVNlYXJjaChjb21tYW5kLmNvdW50cnlfY29kZSwgbnVtYmVyT3JQYXR0ZXJuLCBjb21tYW5kKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLm51bWJlckJ1eUZyb21OdW1iZXIobnVtYmVyT3JQYXR0ZXJuLCBjb21tYW5kKTtcbiAgICB9XG4gIH1cblxuICBudW1iZXJCdXlGcm9tTnVtYmVyKG51bWJlciwgZmxhZ3MpIHtcbiAgICBudW1iZXIgPSBzdHJpcFBsdXMobnVtYmVyKTtcbiAgICBjb25maXJtKGBCdXlpbmcgJHtudW1iZXJ9LiBUaGlzIG9wZXJhdGlvbiB3aWxsIGNoYXJnZSB5b3VyIGFjY291bnQuYCwgdGhpcy5yZXNwb25zZS5lbWl0dGVyLCBmbGFncywgKCkgPT4ge1xuICAgICAgdGhpcy5nZXRDb3VudHJ5Q29kZShudW1iZXIsIGZsYWdzLCAoY291bnRyeV9jb2RlKSA9PiB7XG4gICAgICAgIHRoaXMuY2xpZW50Lmluc3RhbmNlKCkubnVtYmVyLmJ1eShjb3VudHJ5X2NvZGUsIG51bWJlciwgdGhpcy5yZXNwb25zZS5udW1iZXJCdXlGcm9tTnVtYmVyKG51bWJlcikuYmluZCh0aGlzLnJlc3BvbnNlKSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIG51bWJlckJ1eUZyb21TZWFyY2goY291bnRyeV9jb2RlLCBwYXR0ZXJuLCBmbGFncykge1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7IGZlYXR1cmVzOiBbJ1ZPSUNFJ10gfTtcblxuICAgIGlmIChwYXR0ZXJuKSB7XG4gICAgICBvcHRpb25zLnBhdHRlcm4gPSBwYXR0ZXJuO1xuICAgICAgb3B0aW9ucy5zZWFyY2hfcGF0dGVybiA9IDE7XG4gICAgICBpZiAocGF0dGVyblswXSA9PT0gJyonKSBvcHRpb25zLnNlYXJjaF9wYXR0ZXJuID0gMjtcbiAgICAgIGlmIChwYXR0ZXJuLnNsaWNlKC0xKSA9PT0gJyonKSBvcHRpb25zLnNlYXJjaF9wYXR0ZXJuID0gMDtcbiAgICB9XG5cbiAgICB0aGlzLmNsaWVudC5pbnN0YW5jZSgpLm51bWJlci5zZWFyY2goY291bnRyeV9jb2RlLCBvcHRpb25zLCB0aGlzLnJlc3BvbnNlLm51bWJlckJ1eUZyb21QYXR0ZXJuKChudW1iZXIpID0+IHtcbiAgICAgIHRoaXMubnVtYmVyQnV5RnJvbU51bWJlcihudW1iZXIsIGZsYWdzKTtcbiAgICB9KSk7XG4gIH1cblxuICBudW1iZXJDYW5jZWwobnVtYmVyLCBmbGFncykge1xuICAgIGNvbmZpcm0oJ1RoaXMgb3BlcmF0aW9uIGNhbiBub3QgYmUgcmV2ZXJzZWQuJywgdGhpcy5yZXNwb25zZS5lbWl0dGVyLCBmbGFncywgKCkgPT4ge1xuICAgICAgdGhpcy5nZXRDb3VudHJ5Q29kZShudW1iZXIsIGZsYWdzLCAoY291bnRyeV9jb2RlKSA9PiB7XG4gICAgICAgIHRoaXMuY2xpZW50Lmluc3RhbmNlKCkubnVtYmVyLmNhbmNlbChjb3VudHJ5X2NvZGUsIG51bWJlciwgdGhpcy5yZXNwb25zZS5udW1iZXJDYW5jZWwobnVtYmVyKS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gQXBwbGljYXRpb25zXG5cbiAgYXBwbGljYXRpb25zTGlzdChmbGFncykge1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7IHBhZ2Vfc2l6ZTogMTAwIH07XG4gICAgaWYgKGZsYWdzLnBhZ2UpIHsgb3B0aW9ucy5pbmRleCA9IGZsYWdzLnBhZ2U7IH1cbiAgICBpZiAoZmxhZ3Muc2l6ZSkgeyBvcHRpb25zLnBhZ2Vfc2l6ZSA9IGZsYWdzLnNpemU7IH1cblxuICAgIHRoaXMuY2xpZW50Lmluc3RhbmNlKCkuYXBwLmdldChvcHRpb25zLCB0aGlzLnJlc3BvbnNlLmFwcGxpY2F0aW9uc0xpc3QoZmxhZ3MpLmJpbmQodGhpcy5yZXNwb25zZSkpO1xuICB9XG5cbiAgYXBwbGljYXRpb25DcmVhdGUobmFtZSwgYW5zd2VyX3VybCwgZXZlbnRfdXJsLCBmbGFncykge1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7fTtcbiAgICBpZiAoZmxhZ3MuYW5zd2VyX21ldGhvZCkgeyBvcHRpb25zLmFuc3dlcl9tZXRob2QgPSBmbGFncy5hbnN3ZXJfbWV0aG9kOyB9XG4gICAgaWYgKGZsYWdzLmV2ZW50X21ldGhvZCkgeyBvcHRpb25zLmV2ZW50X21ldGhvZCA9IGZsYWdzLmV2ZW50X21ldGhvZDsgfVxuXG4gICAgdGhpcy5jbGllbnQuaW5zdGFuY2UoKS5hcHAuY3JlYXRlKG5hbWUsIGZsYWdzLnR5cGUsIGFuc3dlcl91cmwsIGV2ZW50X3VybCwgb3B0aW9ucywgdGhpcy5yZXNwb25zZS5hcHBsaWNhdGlvbkNyZWF0ZShmbGFncykpO1xuICB9XG5cbiAgYXBwbGljYXRpb25TaG93KGFwcF9pZCkge1xuICAgIHRoaXMuY2xpZW50Lmluc3RhbmNlKCkuYXBwLmdldChhcHBfaWQsIHRoaXMucmVzcG9uc2UuYXBwbGljYXRpb25TaG93LmJpbmQodGhpcy5yZXNwb25zZSkpO1xuICB9XG5cbiAgYXBwbGljYXRpb25VcGRhdGUoYXBwX2lkLCBuYW1lLCBhbnN3ZXJfdXJsLCBldmVudF91cmwsIGZsYWdzKSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHt9O1xuICAgIGlmIChmbGFncy5hbnN3ZXJfbWV0aG9kKSB7IG9wdGlvbnMuYW5zd2VyX21ldGhvZCA9IGZsYWdzLmFuc3dlcl9tZXRob2Q7IH1cbiAgICBpZiAoZmxhZ3MuZXZlbnRfbWV0aG9kKSB7IG9wdGlvbnMuZXZlbnRfbWV0aG9kID0gZmxhZ3MuZXZlbnRfbWV0aG9kOyB9XG5cbiAgICB0aGlzLmNsaWVudC5pbnN0YW5jZSgpLmFwcC51cGRhdGUoYXBwX2lkLCBuYW1lLCBmbGFncy50eXBlLCBhbnN3ZXJfdXJsLCBldmVudF91cmwsIG9wdGlvbnMsIHRoaXMucmVzcG9uc2UuYXBwbGljYXRpb25VcGRhdGUuYmluZCh0aGlzLnJlc3BvbnNlKSk7XG4gIH1cblxuICBhcHBsaWNhdGlvbkRlbGV0ZShhcHBfaWQsIGZsYWdzKSB7XG4gICAgcmV0dXJuIGNvbmZpcm0oJ1RoaXMgb3BlcmF0aW9uIGNhbiBub3QgYmUgcmV2ZXJzZWQuJywgdGhpcy5yZXNwb25zZS5lbWl0dGVyLCBmbGFncywgKCkgPT4ge1xuICAgICAgdGhpcy5jbGllbnQuaW5zdGFuY2UoKS5hcHAuZGVsZXRlKGFwcF9pZCwgdGhpcy5yZXNwb25zZS5hcHBsaWNhdGlvbkRlbGV0ZS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFwcGxpY2F0aW9uTnVtYmVycyhhcHBfaWQsIGZsYWdzKSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHt9O1xuICAgIGlmIChmbGFncy5wYWdlKSB7IG9wdGlvbnMuaW5kZXggPSBmbGFncy5wYWdlOyB9XG4gICAgaWYgKGZsYWdzLnNpemUpIHsgb3B0aW9ucy5zaXplID0gZmxhZ3Muc2l6ZTsgfVxuXG4gICAgdGhpcy5jbGllbnQuaW5zdGFuY2UoKS5udW1iZXIuZ2V0KG9wdGlvbnMsIHRoaXMucmVzcG9uc2UuYXBwbGljYXRpb25OdW1iZXJzKGFwcF9pZCwgZmxhZ3MpLmJpbmQodGhpcy5yZXNwb25zZSkpO1xuICB9XG5cbiAgLy8gbGlua3NcblxuICBsaW5rQXBwKG51bWJlciwgYXBwX2lkLCBmbGFncykge1xuICAgIHRoaXMuX2xpbmsobnVtYmVyLCBmbGFncywgbnVsbCwgJ2FwcCcsIGFwcF9pZCk7XG4gIH1cblxuICBsaW5rU21zKG51bWJlciwgY2FsbGJhY2tfdXJsLCBmbGFncykge1xuICAgIHRoaXMuX2xpbmsobnVtYmVyLCBmbGFncywgY2FsbGJhY2tfdXJsLCAnc21zJywgbnVsbCk7XG4gIH1cblxuICBsaW5rVGVsKG51bWJlciwgb3RoZXJfbnVtYmVyLCBmbGFncykge1xuICAgIHRoaXMuX2xpbmsobnVtYmVyLCBmbGFncywgbnVsbCwgJ3RlbCcsIG90aGVyX251bWJlciwgZmxhZ3Mudm9pY2Vfc3RhdHVzX2NhbGxiYWNrKTtcbiAgfVxuXG4gIGxpbmtTaXAobnVtYmVyLCBzaXBfdXJpLCBmbGFncykge1xuICAgIHRoaXMuX2xpbmsobnVtYmVyLCBmbGFncywgbnVsbCwgJ3NpcCcsIHNpcF91cmksIGZsYWdzLnZvaWNlX3N0YXR1c19jYWxsYmFjayk7XG4gIH1cblxuICBsaW5rVnhtbChudW1iZXIsIGNhbGJhY2tfdXJsLCBmbGFncykge1xuICAgIHRoaXMuX2xpbmsobnVtYmVyLCBmbGFncywgbnVsbCwgJ3Z4bWwnLCBjYWxiYWNrX3VybCwgZmxhZ3Mudm9pY2Vfc3RhdHVzX2NhbGxiYWNrKTtcbiAgfVxuXG4gIHVubGlua0FwcChudW1iZXIsIGZsYWdzKSB7XG4gICAgdGhpcy5fbGluayhudW1iZXIsIGZsYWdzKTtcbiAgfVxuXG4gIHVubGlua1NtcyhudW1iZXIsIGZsYWdzKSB7XG4gICAgdGhpcy5fbGluayhudW1iZXIsIGZsYWdzLCAnJywgJ3NtcycpO1xuICB9XG5cbiAgdW5saW5rVGVsKG51bWJlciwgZmxhZ3MpIHtcbiAgICB0aGlzLl9saW5rKG51bWJlciwgZmxhZ3MsIG51bGwsICd0ZWwnKTtcbiAgfVxuXG4gIHVubGlua1NpcChudW1iZXIsIGZsYWdzKSB7XG4gICAgdGhpcy5fbGluayhudW1iZXIsIGZsYWdzLCBudWxsLCAnc2lwJyk7XG4gIH1cblxuICB1bmxpbmtWeG1sKG51bWJlciwgZmxhZ3MpIHtcbiAgICB0aGlzLl9saW5rKG51bWJlciwgZmxhZ3MsIG51bGwsICd2eG1sJyk7XG4gIH1cblxuICBudW1iZXJVcGRhdGUobnVtYmVyLCBmbGFncykge1xuICAgIG51bWJlciA9IHN0cmlwUGx1cyhudW1iZXIpO1xuICAgIHRoaXMuZ2V0Q291bnRyeUNvZGUobnVtYmVyLCBmbGFncywgKGNvdW50cnlfY29kZSkgPT4ge1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IHt9O1xuICAgICAgaWYgKGZsYWdzLm1vX2h0dHBfdXJsKSBvcHRpb25zLm1vSHR0cFVybCA9IGZsYWdzLm1vX2h0dHBfdXJsO1xuICAgICAgaWYgKGZsYWdzLnZvaWNlX2NhbGxiYWNrX3R5cGUpIG9wdGlvbnMudm9pY2VDYWxsYmFja1R5cGUgPSBmbGFncy52b2ljZV9jYWxsYmFja190eXBlO1xuICAgICAgaWYgKGZsYWdzLnZvaWNlX2NhbGxiYWNrX3ZhbHVlKSBvcHRpb25zLnZvaWNlQ2FsbGJhY2tWYWx1ZSA9IGZsYWdzLnZvaWNlX2NhbGxiYWNrX3ZhbHVlO1xuICAgICAgaWYgKGZsYWdzLnZvaWNlX3N0YXR1c19jYWxsYmFjaykgb3B0aW9ucy52b2ljZVN0YXR1c0NhbGxiYWNrID0gZmxhZ3Mudm9pY2Vfc3RhdHVzX2NhbGxiYWNrO1xuICAgICAgdGhpcy5jbGllbnQuaW5zdGFuY2UoKS5udW1iZXIudXBkYXRlKGNvdW50cnlfY29kZSwgbnVtYmVyLCBvcHRpb25zLCB0aGlzLnJlc3BvbnNlLm51bWJlclVwZGF0ZS5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgICB9KTtcbiAgfVxuXG4gIF9saW5rKG51bWJlciwgZmxhZ3MsIG1vX2h0dHBfdXJsLCB2b2ljZV9jYWxsYmFja190eXBlLCB2b2ljZV9jYWxsYmFja192YWx1ZSwgdm9pY2Vfc3RhdHVzX2NhbGxiYWNrKSB7XG4gICAgaWYgKGZsYWdzID09IG51bGwpIHsgZmxhZ3MgPSB7fTsgfVxuICAgIG51bWJlciA9IHN0cmlwUGx1cyhudW1iZXIpO1xuXG4gICAgdGhpcy5nZXRDb3VudHJ5Q29kZShudW1iZXIsIGZsYWdzLCAoY291bnRyeV9jb2RlKSA9PiB7XG4gICAgICBcblxuICAgICAgY29uc3Qgb3B0aW9ucyA9IHt9O1xuXG4gICAgICBcbiAgICAgIGlmICh2b2ljZV9jYWxsYmFja190eXBlID09ICdzbXMnKSB7XG4gICAgICAgIG9wdGlvbnMubW9IdHRwVXJsID0gbW9faHR0cF91cmw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodm9pY2VfY2FsbGJhY2tfdHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgb3B0aW9ucy52b2ljZUNhbGxiYWNrVHlwZSA9IHZvaWNlX2NhbGxiYWNrX3R5cGU7XG4gICAgICAgICAgaWYgKHZvaWNlX2NhbGxiYWNrX3ZhbHVlKSBvcHRpb25zLnZvaWNlQ2FsbGJhY2tWYWx1ZSA9IHZvaWNlX2NhbGxiYWNrX3ZhbHVlO1xuICAgICAgICAgIGlmICh2b2ljZV9zdGF0dXNfY2FsbGJhY2spIG9wdGlvbnMudm9pY2VTdGF0dXNDYWxsYmFjayA9IHZvaWNlX3N0YXR1c19jYWxsYmFjaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG5cbiAgICAgIHRoaXMuY2xpZW50Lmluc3RhbmNlKCkubnVtYmVyLnVwZGF0ZShjb3VudHJ5X2NvZGUsIG51bWJlciwgb3B0aW9ucywgdGhpcy5yZXNwb25zZS5udW1iZXJVcGRhdGUuYmluZCh0aGlzLnJlc3BvbnNlKSk7XG4gICAgfSk7IFxuICB9XG4gXG4gIC8vIEluc2lnaHRcblxuICBpbnNpZ2h0QmFzaWMobnVtYmVyKSB7XG4gICAgbnVtYmVyID0gc3RyaXBQbHVzKG51bWJlcik7XG4gICAgdGhpcy5jbGllbnQuaW5zdGFuY2UoKS5udW1iZXJJbnNpZ2h0LmdldCh7IGxldmVsOiAnYmFzaWMnLCBudW1iZXI6IG51bWJlciB9LCB0aGlzLnJlc3BvbnNlLmluc2lnaHRCYXNpYy5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgfVxuXG4gIGluc2lnaHRTdGFuZGFyZChudW1iZXIsIGZsYWdzKSB7XG4gICAgbnVtYmVyID0gc3RyaXBQbHVzKG51bWJlcik7XG4gICAgY29uZmlybSgnVGhpcyBvcGVyYXRpb24gd2lsbCBjaGFyZ2UgeW91ciBhY2NvdW50LicsIHRoaXMucmVzcG9uc2UuZW1pdHRlciwgZmxhZ3MsICgpID0+IHtcbiAgICAgIHRoaXMuY2xpZW50Lmluc3RhbmNlKCkubnVtYmVySW5zaWdodC5nZXQoeyBsZXZlbDogJ3N0YW5kYXJkJywgbnVtYmVyOiBudW1iZXIgfSwgdGhpcy5yZXNwb25zZS5pbnNpZ2h0U3RhbmRhcmQuYmluZCh0aGlzLnJlc3BvbnNlKSk7XG4gICAgfSk7XG4gIH1cblxuICBpbnNpZ2h0QWR2YW5jZWQobnVtYmVyLCBmbGFncykge1xuICAgIG51bWJlciA9IHN0cmlwUGx1cyhudW1iZXIpO1xuICAgIGNvbmZpcm0oJ1RoaXMgb3BlcmF0aW9uIHdpbGwgY2hhcmdlIHlvdXIgYWNjb3VudC4nLCB0aGlzLnJlc3BvbnNlLmVtaXR0ZXIsIGZsYWdzLCAoKSA9PiB7XG4gICAgICB0aGlzLmNsaWVudC5pbnN0YW5jZSgpLm51bWJlckluc2lnaHQuZ2V0KHsgbGV2ZWw6ICdhZHZhbmNlZFN5bmMnLCBudW1iZXI6IG51bWJlciB9LCB0aGlzLnJlc3BvbnNlLmluc2lnaHRTdGFuZGFyZC5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIHNlbmRpbmcgbWVzc2FnZXNcblxuICBzZW5kU21zKHRvLCB0ZXh0LCBmbGFncykge1xuICAgIGNvbmZpcm0oJ1RoaXMgb3BlcmF0aW9uIHdpbGwgY2hhcmdlIHlvdXIgYWNjb3VudC4nLCB0aGlzLnJlc3BvbnNlLmVtaXR0ZXIsIGZsYWdzLCAoKSA9PiB7XG4gICAgICB0aGlzLmNsaWVudC5pbnN0YW5jZSgpLm1lc3NhZ2Uuc2VuZFNtcyhmbGFncy5mcm9tLCB0bywgdGV4dC5qb2luKCcgJyksIHRoaXMucmVzcG9uc2Uuc2VuZFNtcy5iaW5kKHRoaXMucmVzcG9uc2UpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdlbmVyYXRlSnd0KHByaXZhdGVLZXksIGNsYWltcywgZmxhZ3MpIHtcbiAgICBsZXQgdG9rZW4gPSBudWxsO1xuICAgIGxldCBlcnJvciA9IG51bGw7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgZnVsbENsYWltcyA9IHt9O1xuICAgICAgaWYgKGZsYWdzLmFwcF9pZCkge1xuICAgICAgICBmdWxsQ2xhaW1zWydhcHBsaWNhdGlvbl9pZCddID0gZmxhZ3MuYXBwX2lkO1xuICAgICAgfVxuXG4gICAgICBjbGFpbXMuZm9yRWFjaCgoY2xhaW0pID0+IHtcbiAgICAgICAgY29uc3QgbmFtZVZhbHVlID0gY2xhaW0uc3BsaXQoJz0nKTtcbiAgICAgICAgaWYgKG5hbWVWYWx1ZS5sZW5ndGggIT09IDIpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FsbCBjbGFpbXMgbXVzdCBiZSBpbiB0aGUgZm9ybSBgbmFtZT12YWx1ZWAuIEdvdDogJyArIG5hbWVWYWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVXNpbmcgSlNPTi5wYXJzZSB0byBjYXN0ICdleHAnIHRvIG51bWJlclxuICAgICAgICBpZiAobmFtZVZhbHVlWzBdID09PSAnYWNsJyB8fCBuYW1lVmFsdWVbMF0gPT09ICdleHAnKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZ1bGxDbGFpbXNbbmFtZVZhbHVlWzBdXSA9IEpTT04ucGFyc2UobmFtZVZhbHVlWzFdKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBmdWxsQ2xhaW1zW25hbWVWYWx1ZVswXV0gPSBuYW1lVmFsdWVbMV07XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZ1bGxDbGFpbXNbbmFtZVZhbHVlWzBdXSA9IG5hbWVWYWx1ZVsxXTtcbiAgICAgICAgfVxuXG4gICAgICB9KTtcblxuICAgICAgdG9rZW4gPSB0aGlzLmNsaWVudC5kZWZpbml0aW9uKCkuZ2VuZXJhdGVKd3QocHJpdmF0ZUtleSwgZnVsbENsYWltcyk7XG4gICAgfVxuICAgIGNhdGNoIChleCkge1xuICAgICAgZXJyb3IgPSBleDtcbiAgICB9XG4gICAgdGhpcy5yZXNwb25zZS5nZW5lcmF0ZUp3dChlcnJvciwgdG9rZW4pO1xuICB9XG5cbiAgZ2V0Q291bnRyeUNvZGUobnVtYmVyLCBmbGFncywgY2FsbGJhY2spIHtcbiAgICBpZiAoZmxhZ3MuY291bnRyeV9jb2RlKSB7XG4gICAgICBjYWxsYmFjayhmbGFncy5jb3VudHJ5X2NvZGUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuY2xpZW50Lmluc3RhbmNlKCkubnVtYmVySW5zaWdodC5nZXQoeyBsZXZlbDogJ2Jhc2ljJywgbnVtYmVyOiBudW1iZXIgfSwgdGhpcy5yZXNwb25zZS5udW1iZXJJbnNpZ2h0KChyZXNwb25zZSkgPT4ge1xuICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5jb3VudHJ5X2NvZGUpO1xuICAgICAgfSkpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSZXF1ZXN0O1xuXG4vLyBwcml2YXRlIG1ldGhvZHNcblxuY29uc3QgY29uZmlybSA9IGZ1bmN0aW9uIChtZXNzYWdlLCBlbWl0dGVyLCBmbGFncywgY2FsbGJhY2spIHtcbiAgaWYgKGZsYWdzLmNvbmZpcm0pIHtcbiAgICBjYWxsYmFjaygpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGNsaSA9IHJlYWRsaW5lLmNyZWF0ZUludGVyZmFjZShwcm9jZXNzLnN0ZGluLCBwcm9jZXNzLnN0ZG91dCk7XG4gICAgY2xpLnF1ZXN0aW9uKG1lc3NhZ2UgKyAnXFxuXFxuUGxlYXNlIHR5cGUgXCJjb25maXJtXCIgdG8gY29udGludWU6ICcsIChhbnN3ZXIpID0+IHtcbiAgICAgIGlmIChhbnN3ZXIudG9TdHJpbmcoKS50cmltKCkgPT0gJ2NvbmZpcm0nKSB7XG4gICAgICAgIGVtaXR0ZXIubG9nKCcgJyk7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XG4gICAgICB9XG5cbiAgICAgIGNsaS5jbG9zZSgpO1xuICAgICAgcHJvY2Vzcy5zdGRpbi5kZXN0cm95KCk7XG4gICAgfSk7XG4gIH1cbn07XG5cbmNvbnN0IHN0cmlwUGx1cyA9IGZ1bmN0aW9uIChudW1iZXIpIHtcbiAgaWYgKCFudW1iZXIpIHsgcmV0dXJuIG51bWJlcjsgfVxuICB3aGlsZSAobnVtYmVyLmNoYXJBdCgwKSA9PT0gJysnKSB7XG4gICAgbnVtYmVyID0gbnVtYmVyLnN1YnN0cigxKTtcbiAgfVxuICByZXR1cm4gbnVtYmVyO1xufTtcbiJdfQ==