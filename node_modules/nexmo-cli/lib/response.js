"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _colors = _interopRequireDefault(require("colors"));

var _fs = _interopRequireDefault(require("fs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var Response =
/*#__PURE__*/
function () {
  function Response(validator, emitter) {
    _classCallCheck(this, Response);

    this.emitter = emitter;
    this.validator = validator;
  }

  _createClass(Response, [{
    key: "accountSetup",
    value: function accountSetup(config, key, secret, flags) {
      var _this = this;

      return function (error, response) {
        _this.validator.response(error, response);

        config.putAndSave({
          'credentials': {
            'api_key': key,
            'api_secret': secret
          }
        }, flags.local);
      };
    }
  }, {
    key: "accountInfo",
    value: function accountInfo(client) {
      this.emitter.log("API Key:    ".concat(client.credentials.apiKey, "\nAPI Secret: ").concat(client.credentials.apiSecret));
    }
  }, {
    key: "accountKey",
    value: function accountKey(client) {
      this.emitter.log("".concat(client.credentials.apiKey));
    }
  }, {
    key: "accountSecret",
    value: function accountSecret(client) {
      this.emitter.log("".concat(client.credentials.apiSecret));
    }
  }, {
    key: "accountBalance",
    value: function accountBalance(error, response) {
      this.validator.response(error, response);
      this.emitter.log("".concat(Number(response.value.toFixed(2)), " EUR"), "".concat(response.value, " EUR"));
    } // Pricing

  }, {
    key: "priceSms",
    value: function priceSms(error, response) {
      this.validator.response(error, response);
      this.emitter.log("".concat(response.price, " EUR"));
    }
  }, {
    key: "priceVoice",
    value: function priceVoice(error, response) {
      this.validator.response(error, response);
      this.emitter.log("".concat(response.price, " EUR"));
    }
  }, {
    key: "priceCountry",
    value: function priceCountry(error, response) {
      this.validator.response(error, response);

      if (response.networks && this.emitter.amplified) {
        this.emitter.table(response.networks, ['network', 'mtPrice'], ['network', 'mtPrice']);
      } else if (response.mt) {
        var price = this._maxPrice(response);

        this.emitter.log("".concat(price, " EUR"));
      } else {
        this.emitter.log('No price found');
      }
    }
  }, {
    key: "_maxPrice",
    value: function _maxPrice(response) {
      var prices = response.networks.map(function (network) {
        return parseFloat(network.mtPrice);
      });
      prices.push(parseFloat(response.mt));
      return Math.max.apply(null, prices);
    } // numbers

  }, {
    key: "numbersList",
    value: function numbersList(flags) {
      var _this2 = this;

      return function (error, response) {
        _this2.validator.response(error, response);

        if (response.numbers && response.numbers.length > 0) {
          _this2.emitter.pagination(flags, response);

          _this2.emitter.table(response.numbers, ['msisdn'], ['msisdn', 'country', 'type', 'features', 'voiceCallbackType', 'voiceCallbackValue', 'moHttpUrl', 'voiceStatusCallbackUrl']);
        } else {
          _this2.emitter.warn('No numbers');
        }
      };
    }
  }, {
    key: "numberSearch",
    value: function numberSearch(flags) {
      var _this3 = this;

      return function (error, response) {
        _this3.validator.response(error, response);

        if (response.numbers && response.numbers.length > 0) {
          _this3.emitter.pagination(flags, response);

          _this3.emitter.table(response.numbers, ['msisdn'], ['msisdn', 'country', 'cost', 'type', 'features']);
        } else {
          _this3.emitter.warn('No numbers');
        }
      };
    }
  }, {
    key: "numberBuyFromNumber",
    value: function numberBuyFromNumber(number) {
      var _this4 = this;

      return function (error, response) {
        _this4.validator.response(error, response);

        _this4.emitter.log("Number purchased: ".concat(number));
      };
    }
  }, {
    key: "numberBuyFromPattern",
    value: function numberBuyFromPattern(callback) {
      var _this5 = this;

      return function (error, response) {
        _this5.validator.response(error, response);

        if (response.numbers && response.numbers.length > 0) {
          callback(response.numbers[0].msisdn);
        } else {
          _this5.emitter.error('No numbers match your search');
        }
      };
    }
  }, {
    key: "numberCancel",
    value: function numberCancel(number) {
      var _this6 = this;

      return function (error, response) {
        _this6.validator.response(error, response);

        _this6.emitter.log("Number cancelled: ".concat(number));
      };
    }
  }, {
    key: "numberInsight",
    value: function numberInsight(callback) {
      var _this7 = this;

      return function (error, response) {
        _this7.validator.response(error, response);

        callback(response);
      };
    } // applications

  }, {
    key: "applicationsList",
    value: function applicationsList(flags) {
      var _this8 = this;

      return function (error, response) {
        _this8.validator.response(error, response);

        if (response._embedded && response._embedded.applications && response._embedded.applications.length > 0) {
          _this8.emitter.pagination(flags, response);

          _this8.emitter.table(response._embedded.applications, ['id', 'name'], ['id', 'name']);
        } else {
          _this8.emitter.warn('No applications');
        }
      };
    }
  }, {
    key: "applicationCreate",
    value: function applicationCreate(flags) {
      var _this9 = this;

      return function (error, response) {
        _this9.validator.response(error, response);

        _this9.emitter.list("Application created: ".concat(response.id), response);

        _this9._writeKey(flags.keyfile, response.keys.private_key);
      };
    }
  }, {
    key: "applicationShow",
    value: function applicationShow(error, response) {
      this.validator.response(error, response);
      this.emitter.list(null, response);
    }
  }, {
    key: "applicationUpdate",
    value: function applicationUpdate(error, response) {
      this.validator.response(error, response);
      this.emitter.list("Application updated: ".concat(response.id), response);
    }
  }, {
    key: "applicationDelete",
    value: function applicationDelete(error, response) {
      this.validator.response(error, response);
      this.emitter.log('Application deleted');
    }
  }, {
    key: "applicationNumbers",
    value: function applicationNumbers(app_id, flags) {
      var _this10 = this;

      return function (error, response) {
        _this10.validator.response(error, response);

        if (response.numbers && response.numbers.length > 0) {
          response.numbers = response.numbers.filter(function (number) {
            return number.voiceCallbackValue == app_id;
          });

          _this10.emitter.pagination(flags, response);

          _this10.emitter.table(response.numbers, ['msisdn'], ['msisdn', 'country', 'type', 'features', 'voiceCallbackType', 'voiceCallbackValue', 'moHttpUrl', 'voiceStatusCallbackUrl']);
        } else {
          _this10.emitter.warn('No numbers');
        }
      };
    } // links

  }, {
    key: "numberUpdate",
    value: function numberUpdate(error, response) {
      this.validator.response(error, response);
      this.emitter.log('Number updated');
    } // insight

  }, {
    key: "insightBasic",
    value: function insightBasic(error, response) {
      this.validator.response(error, response);
      this.emitter.list("".concat(response.international_format_number, " | ").concat(response.country_code), response);
    }
  }, {
    key: "insightStandard",
    value: function insightStandard(error, response) {
      this.validator.response(error, response);
      this.emitter.list("".concat(response.international_format_number, " | ").concat(response.country_code, " | ").concat(response.current_carrier.name), response);
    }
  }, {
    key: "_writeKey",
    value: function _writeKey(keyfile, private_key) {
      var _this11 = this;

      if (keyfile) {
        _fs.default.writeFile(keyfile, private_key, function (error) {
          if (error) {
            _this11.emitter.warn(error.message);

            _this11._promptKey(private_key);
          } else {
            _this11.emitter.log("Private Key saved to: ".concat(keyfile));
          }
        });
      } else {
        this._promptKey(private_key);
      }
    }
  }, {
    key: "_promptKey",
    value: function _promptKey(private_key) {
      this.emitter.log('\nPrivate Key:\n');
      this.emitter.log(_colors.default.red.bgWhite("".concat(private_key, "\n")));
      this.emitter.log('WARNING: You should save this key somewhere safe and secure now, it will not be provided again.');
    } // sending messages

  }, {
    key: "sendSms",
    value: function sendSms(error, response) {
      this.validator.response(error, response);
      var message = response.messages[0];
      this.emitter.log("Message sent to:   ".concat(message.to, "\nRemaining balance: ").concat(message['remaining-balance'], " EUR\nMessage price:     ").concat(message['message-price'], " EUR"));
    } // JWT

  }, {
    key: "generateJwt",
    value: function generateJwt(error, token) {
      this.validator.response(error, token);
      this.emitter.log("".concat(token), "JWT:   ".concat(token));
    }
  }]);

  return Response;
}();

var _default = Response;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXNwb25zZS5qcyJdLCJuYW1lcyI6WyJSZXNwb25zZSIsInZhbGlkYXRvciIsImVtaXR0ZXIiLCJjb25maWciLCJrZXkiLCJzZWNyZXQiLCJmbGFncyIsImVycm9yIiwicmVzcG9uc2UiLCJwdXRBbmRTYXZlIiwibG9jYWwiLCJjbGllbnQiLCJsb2ciLCJjcmVkZW50aWFscyIsImFwaUtleSIsImFwaVNlY3JldCIsIk51bWJlciIsInZhbHVlIiwidG9GaXhlZCIsInByaWNlIiwibmV0d29ya3MiLCJhbXBsaWZpZWQiLCJ0YWJsZSIsIm10IiwiX21heFByaWNlIiwicHJpY2VzIiwibWFwIiwibmV0d29yayIsInBhcnNlRmxvYXQiLCJtdFByaWNlIiwicHVzaCIsIk1hdGgiLCJtYXgiLCJhcHBseSIsIm51bWJlcnMiLCJsZW5ndGgiLCJwYWdpbmF0aW9uIiwid2FybiIsIm51bWJlciIsImNhbGxiYWNrIiwibXNpc2RuIiwiX2VtYmVkZGVkIiwiYXBwbGljYXRpb25zIiwibGlzdCIsImlkIiwiX3dyaXRlS2V5Iiwia2V5ZmlsZSIsImtleXMiLCJwcml2YXRlX2tleSIsImFwcF9pZCIsImZpbHRlciIsInZvaWNlQ2FsbGJhY2tWYWx1ZSIsImludGVybmF0aW9uYWxfZm9ybWF0X251bWJlciIsImNvdW50cnlfY29kZSIsImN1cnJlbnRfY2FycmllciIsIm5hbWUiLCJmcyIsIndyaXRlRmlsZSIsIm1lc3NhZ2UiLCJfcHJvbXB0S2V5IiwiY29sb3JzIiwicmVkIiwiYmdXaGl0ZSIsIm1lc3NhZ2VzIiwidG8iLCJ0b2tlbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOzs7Ozs7Ozs7O0lBRU1BLFE7OztBQUNKLG9CQUFZQyxTQUFaLEVBQXVCQyxPQUF2QixFQUFnQztBQUFBOztBQUM5QixTQUFLQSxPQUFMLEdBQWVBLE9BQWY7QUFDQSxTQUFLRCxTQUFMLEdBQWlCQSxTQUFqQjtBQUNEOzs7O2lDQUVZRSxNLEVBQVFDLEcsRUFBS0MsTSxF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LFdBQUtoRSxTQUFMLENBQWVPLFFBQWYsQ0FBd0JELEtBQXhCLEVBQStCMEQsS0FBL0I7QUFDQSxXQUFLL0QsT0FBTCxDQUFhVSxHQUFiLFdBQW9CcUQsS0FBcEIsb0JBQXVDQSxLQUF2QztBQUNEOzs7Ozs7ZUFHWWpFLFEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY29sb3JzIGZyb20gJ2NvbG9ycyc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuXG5jbGFzcyBSZXNwb25zZSB7XG4gIGNvbnN0cnVjdG9yKHZhbGlkYXRvciwgZW1pdHRlcikge1xuICAgIHRoaXMuZW1pdHRlciA9IGVtaXR0ZXI7XG4gICAgdGhpcy52YWxpZGF0b3IgPSB2YWxpZGF0b3I7XG4gIH1cblxuICBhY2NvdW50U2V0dXAoY29uZmlnLCBrZXksIHNlY3JldCwgZmxhZ3MpIHtcbiAgICByZXR1cm4gKGVycm9yLCByZXNwb25zZSkgPT4ge1xuICAgICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICAgIGNvbmZpZy5wdXRBbmRTYXZlKHtcbiAgICAgICAgJ2NyZWRlbnRpYWxzJzoge1xuICAgICAgICAgICdhcGlfa2V5Jzoga2V5LFxuICAgICAgICAgICdhcGlfc2VjcmV0Jzogc2VjcmV0XG4gICAgICAgIH1cbiAgICAgIH0sIGZsYWdzLmxvY2FsKTtcbiAgICB9O1xuICB9XG5cbiAgYWNjb3VudEluZm8oY2xpZW50KSB7XG4gICAgdGhpcy5lbWl0dGVyLmxvZyhcbiAgICAgIGBBUEkgS2V5OiAgICAke2NsaWVudC5jcmVkZW50aWFscy5hcGlLZXl9XG5BUEkgU2VjcmV0OiAke2NsaWVudC5jcmVkZW50aWFscy5hcGlTZWNyZXR9YFxuICAgICk7XG4gIH1cblxuICBhY2NvdW50S2V5KGNsaWVudCkge1xuICAgIHRoaXMuZW1pdHRlci5sb2coXG4gICAgICBgJHtjbGllbnQuY3JlZGVudGlhbHMuYXBpS2V5fWBcbiAgICApO1xuICB9XG5cbiAgYWNjb3VudFNlY3JldChjbGllbnQpIHtcbiAgICB0aGlzLmVtaXR0ZXIubG9nKFxuICAgICAgYCR7Y2xpZW50LmNyZWRlbnRpYWxzLmFwaVNlY3JldH1gXG4gICAgKTtcbiAgfVxuXG4gIGFjY291bnRCYWxhbmNlKGVycm9yLCByZXNwb25zZSkge1xuICAgIHRoaXMudmFsaWRhdG9yLnJlc3BvbnNlKGVycm9yLCByZXNwb25zZSk7XG4gICAgdGhpcy5lbWl0dGVyLmxvZyhcbiAgICAgIGAke051bWJlcigocmVzcG9uc2UudmFsdWUpLnRvRml4ZWQoMikpfSBFVVJgLFxuICAgICAgYCR7cmVzcG9uc2UudmFsdWV9IEVVUmBcbiAgICApO1xuICB9XG5cbiAgLy8gUHJpY2luZ1xuXG4gIHByaWNlU21zKGVycm9yLCByZXNwb25zZSkge1xuICAgIHRoaXMudmFsaWRhdG9yLnJlc3BvbnNlKGVycm9yLCByZXNwb25zZSk7XG4gICAgdGhpcy5lbWl0dGVyLmxvZyhgJHtyZXNwb25zZS5wcmljZX0gRVVSYCk7XG4gIH1cblxuICBwcmljZVZvaWNlKGVycm9yLCByZXNwb25zZSkge1xuICAgIHRoaXMudmFsaWRhdG9yLnJlc3BvbnNlKGVycm9yLCByZXNwb25zZSk7XG4gICAgdGhpcy5lbWl0dGVyLmxvZyhgJHtyZXNwb25zZS5wcmljZX0gRVVSYCk7XG4gIH1cblxuICBwcmljZUNvdW50cnkoZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICBpZiAocmVzcG9uc2UubmV0d29ya3MgJiYgdGhpcy5lbWl0dGVyLmFtcGxpZmllZCkge1xuICAgICAgdGhpcy5lbWl0dGVyLnRhYmxlKHJlc3BvbnNlLm5ldHdvcmtzLCBbJ25ldHdvcmsnLCAnbXRQcmljZSddLCBbJ25ldHdvcmsnLCAnbXRQcmljZSddKTtcbiAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLm10KSB7XG4gICAgICBjb25zdCBwcmljZSA9IHRoaXMuX21heFByaWNlKHJlc3BvbnNlKTtcbiAgICAgIHRoaXMuZW1pdHRlci5sb2coYCR7cHJpY2V9IEVVUmApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmVtaXR0ZXIubG9nKCdObyBwcmljZSBmb3VuZCcpO1xuICAgIH1cbiAgfVxuXG4gIF9tYXhQcmljZShyZXNwb25zZSkge1xuICAgIGNvbnN0IHByaWNlcyA9IHJlc3BvbnNlLm5ldHdvcmtzLm1hcCgobmV0d29yaykgPT4ge1xuICAgICAgcmV0dXJuIHBhcnNlRmxvYXQobmV0d29yay5tdFByaWNlKTtcbiAgICB9KTtcbiAgICBwcmljZXMucHVzaChwYXJzZUZsb2F0KHJlc3BvbnNlLm10KSk7XG4gICAgcmV0dXJuIE1hdGgubWF4LmFwcGx5KG51bGwsIHByaWNlcyk7XG4gIH1cblxuICAvLyBudW1iZXJzXG5cbiAgbnVtYmVyc0xpc3QoZmxhZ3MpIHtcbiAgICByZXR1cm4gKGVycm9yLCByZXNwb25zZSkgPT4ge1xuICAgICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICAgIGlmIChyZXNwb25zZS5udW1iZXJzICYmIHJlc3BvbnNlLm51bWJlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICB0aGlzLmVtaXR0ZXIucGFnaW5hdGlvbihmbGFncywgcmVzcG9uc2UpO1xuICAgICAgICB0aGlzLmVtaXR0ZXIudGFibGUocmVzcG9uc2UubnVtYmVycywgWydtc2lzZG4nXSwgWydtc2lzZG4nLCAnY291bnRyeScsICd0eXBlJywgJ2ZlYXR1cmVzJywgJ3ZvaWNlQ2FsbGJhY2tUeXBlJywgJ3ZvaWNlQ2FsbGJhY2tWYWx1ZScsICdtb0h0dHBVcmwnLCAndm9pY2VTdGF0dXNDYWxsYmFja1VybCddKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZW1pdHRlci53YXJuKCdObyBudW1iZXJzJyk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIG51bWJlclNlYXJjaChmbGFncykge1xuICAgIHJldHVybiAoZXJyb3IsIHJlc3BvbnNlKSA9PiB7XG4gICAgICB0aGlzLnZhbGlkYXRvci5yZXNwb25zZShlcnJvciwgcmVzcG9uc2UpO1xuICAgICAgaWYgKHJlc3BvbnNlLm51bWJlcnMgJiYgcmVzcG9uc2UubnVtYmVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRoaXMuZW1pdHRlci5wYWdpbmF0aW9uKGZsYWdzLCByZXNwb25zZSk7XG4gICAgICAgIHRoaXMuZW1pdHRlci50YWJsZShyZXNwb25zZS5udW1iZXJzLCBbJ21zaXNkbiddLCBbJ21zaXNkbicsICdjb3VudHJ5JywgJ2Nvc3QnLCAndHlwZScsICdmZWF0dXJlcyddKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZW1pdHRlci53YXJuKCdObyBudW1iZXJzJyk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIG51bWJlckJ1eUZyb21OdW1iZXIobnVtYmVyKSB7XG4gICAgcmV0dXJuIChlcnJvciwgcmVzcG9uc2UpID0+IHtcbiAgICAgIHRoaXMudmFsaWRhdG9yLnJlc3BvbnNlKGVycm9yLCByZXNwb25zZSk7XG4gICAgICB0aGlzLmVtaXR0ZXIubG9nKGBOdW1iZXIgcHVyY2hhc2VkOiAke251bWJlcn1gKTtcbiAgICB9O1xuICB9XG5cbiAgbnVtYmVyQnV5RnJvbVBhdHRlcm4oY2FsbGJhY2spIHtcbiAgICByZXR1cm4gKGVycm9yLCByZXNwb25zZSkgPT4ge1xuICAgICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICAgIGlmIChyZXNwb25zZS5udW1iZXJzICYmIHJlc3BvbnNlLm51bWJlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICBjYWxsYmFjayhyZXNwb25zZS5udW1iZXJzWzBdLm1zaXNkbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmVtaXR0ZXIuZXJyb3IoJ05vIG51bWJlcnMgbWF0Y2ggeW91ciBzZWFyY2gnKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgbnVtYmVyQ2FuY2VsKG51bWJlcikge1xuICAgIHJldHVybiAoZXJyb3IsIHJlc3BvbnNlKSA9PiB7XG4gICAgICB0aGlzLnZhbGlkYXRvci5yZXNwb25zZShlcnJvciwgcmVzcG9uc2UpO1xuICAgICAgdGhpcy5lbWl0dGVyLmxvZyhgTnVtYmVyIGNhbmNlbGxlZDogJHtudW1iZXJ9YCk7XG4gICAgfTtcbiAgfVxuXG4gIG51bWJlckluc2lnaHQoY2FsbGJhY2spIHtcbiAgICByZXR1cm4gKGVycm9yLCByZXNwb25zZSkgPT4ge1xuICAgICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTtcbiAgICB9O1xuICB9XG5cbiAgLy8gYXBwbGljYXRpb25zXG5cbiAgYXBwbGljYXRpb25zTGlzdChmbGFncykge1xuICAgIHJldHVybiAoZXJyb3IsIHJlc3BvbnNlKSA9PiB7XG4gICAgICB0aGlzLnZhbGlkYXRvci5yZXNwb25zZShlcnJvciwgcmVzcG9uc2UpO1xuICAgICAgaWYgKHJlc3BvbnNlLl9lbWJlZGRlZCAmJiByZXNwb25zZS5fZW1iZWRkZWQuYXBwbGljYXRpb25zICYmIHJlc3BvbnNlLl9lbWJlZGRlZC5hcHBsaWNhdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICB0aGlzLmVtaXR0ZXIucGFnaW5hdGlvbihmbGFncywgcmVzcG9uc2UpO1xuICAgICAgICB0aGlzLmVtaXR0ZXIudGFibGUocmVzcG9uc2UuX2VtYmVkZGVkLmFwcGxpY2F0aW9ucywgWydpZCcsICduYW1lJ10sIFsnaWQnLCAnbmFtZSddKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZW1pdHRlci53YXJuKCdObyBhcHBsaWNhdGlvbnMnKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgYXBwbGljYXRpb25DcmVhdGUoZmxhZ3MpIHtcbiAgICByZXR1cm4gKGVycm9yLCByZXNwb25zZSkgPT4ge1xuICAgICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICAgIHRoaXMuZW1pdHRlci5saXN0KGBBcHBsaWNhdGlvbiBjcmVhdGVkOiAke3Jlc3BvbnNlLmlkfWAsIHJlc3BvbnNlKTtcbiAgICAgIHRoaXMuX3dyaXRlS2V5KGZsYWdzLmtleWZpbGUsIHJlc3BvbnNlLmtleXMucHJpdmF0ZV9rZXkpO1xuICAgIH07XG4gIH1cblxuICBhcHBsaWNhdGlvblNob3coZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICB0aGlzLmVtaXR0ZXIubGlzdChudWxsLCByZXNwb25zZSk7XG4gIH1cblxuICBhcHBsaWNhdGlvblVwZGF0ZShlcnJvciwgcmVzcG9uc2UpIHtcbiAgICB0aGlzLnZhbGlkYXRvci5yZXNwb25zZShlcnJvciwgcmVzcG9uc2UpO1xuICAgIHRoaXMuZW1pdHRlci5saXN0KGBBcHBsaWNhdGlvbiB1cGRhdGVkOiAke3Jlc3BvbnNlLmlkfWAsIHJlc3BvbnNlKTtcbiAgfVxuXG4gIGFwcGxpY2F0aW9uRGVsZXRlKGVycm9yLCByZXNwb25zZSkge1xuICAgIHRoaXMudmFsaWRhdG9yLnJlc3BvbnNlKGVycm9yLCByZXNwb25zZSk7XG4gICAgdGhpcy5lbWl0dGVyLmxvZygnQXBwbGljYXRpb24gZGVsZXRlZCcpO1xuICB9XG5cbiAgYXBwbGljYXRpb25OdW1iZXJzKGFwcF9pZCwgZmxhZ3MpIHtcbiAgICByZXR1cm4gKGVycm9yLCByZXNwb25zZSkgPT4ge1xuICAgICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICAgIGlmIChyZXNwb25zZS5udW1iZXJzICYmIHJlc3BvbnNlLm51bWJlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICByZXNwb25zZS5udW1iZXJzID0gcmVzcG9uc2UubnVtYmVycy5maWx0ZXIoKG51bWJlcikgPT4ge1xuICAgICAgICAgIHJldHVybiBudW1iZXIudm9pY2VDYWxsYmFja1ZhbHVlID09IGFwcF9pZDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5lbWl0dGVyLnBhZ2luYXRpb24oZmxhZ3MsIHJlc3BvbnNlKTtcbiAgICAgICAgdGhpcy5lbWl0dGVyLnRhYmxlKHJlc3BvbnNlLm51bWJlcnMsIFsnbXNpc2RuJ10sIFsnbXNpc2RuJywgJ2NvdW50cnknLCAndHlwZScsICdmZWF0dXJlcycsICd2b2ljZUNhbGxiYWNrVHlwZScsICd2b2ljZUNhbGxiYWNrVmFsdWUnLCAnbW9IdHRwVXJsJywgJ3ZvaWNlU3RhdHVzQ2FsbGJhY2tVcmwnXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmVtaXR0ZXIud2FybignTm8gbnVtYmVycycpO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvLyBsaW5rc1xuXG4gIG51bWJlclVwZGF0ZShlcnJvciwgcmVzcG9uc2UpIHtcbiAgICB0aGlzLnZhbGlkYXRvci5yZXNwb25zZShlcnJvciwgcmVzcG9uc2UpO1xuICAgIHRoaXMuZW1pdHRlci5sb2coJ051bWJlciB1cGRhdGVkJyk7XG4gIH1cblxuICAvLyBpbnNpZ2h0XG5cbiAgaW5zaWdodEJhc2ljKGVycm9yLCByZXNwb25zZSkge1xuICAgIHRoaXMudmFsaWRhdG9yLnJlc3BvbnNlKGVycm9yLCByZXNwb25zZSk7XG4gICAgdGhpcy5lbWl0dGVyLmxpc3QoYCR7cmVzcG9uc2UuaW50ZXJuYXRpb25hbF9mb3JtYXRfbnVtYmVyfSB8ICR7cmVzcG9uc2UuY291bnRyeV9jb2RlfWAsIHJlc3BvbnNlKTtcbiAgfVxuXG4gIGluc2lnaHRTdGFuZGFyZChlcnJvciwgcmVzcG9uc2UpIHtcbiAgICB0aGlzLnZhbGlkYXRvci5yZXNwb25zZShlcnJvciwgcmVzcG9uc2UpO1xuICAgIHRoaXMuZW1pdHRlci5saXN0KGAke3Jlc3BvbnNlLmludGVybmF0aW9uYWxfZm9ybWF0X251bWJlcn0gfCAke3Jlc3BvbnNlLmNvdW50cnlfY29kZX0gfCAke3Jlc3BvbnNlLmN1cnJlbnRfY2Fycmllci5uYW1lfWAsIHJlc3BvbnNlKTtcbiAgfVxuXG4gIF93cml0ZUtleShrZXlmaWxlLCBwcml2YXRlX2tleSkge1xuICAgIGlmIChrZXlmaWxlKSB7XG4gICAgICBmcy53cml0ZUZpbGUoa2V5ZmlsZSwgcHJpdmF0ZV9rZXksIChlcnJvcikgPT4ge1xuICAgICAgICBpZihlcnJvcikge1xuICAgICAgICAgIHRoaXMuZW1pdHRlci53YXJuKGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAgIHRoaXMuX3Byb21wdEtleShwcml2YXRlX2tleSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5lbWl0dGVyLmxvZyhgUHJpdmF0ZSBLZXkgc2F2ZWQgdG86ICR7a2V5ZmlsZX1gKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3Byb21wdEtleShwcml2YXRlX2tleSk7XG4gICAgfVxuICB9XG5cbiAgX3Byb21wdEtleShwcml2YXRlX2tleSkge1xuICAgIHRoaXMuZW1pdHRlci5sb2coJ1xcblByaXZhdGUgS2V5OlxcbicpO1xuICAgIHRoaXMuZW1pdHRlci5sb2coY29sb3JzLnJlZC5iZ1doaXRlKGAke3ByaXZhdGVfa2V5fVxcbmApKTtcbiAgICB0aGlzLmVtaXR0ZXIubG9nKCdXQVJOSU5HOiBZb3Ugc2hvdWxkIHNhdmUgdGhpcyBrZXkgc29tZXdoZXJlIHNhZmUgYW5kIHNlY3VyZSBub3csIGl0IHdpbGwgbm90IGJlIHByb3ZpZGVkIGFnYWluLicpO1xuICB9XG5cbiAgLy8gc2VuZGluZyBtZXNzYWdlc1xuXG4gIHNlbmRTbXMoZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICBjb25zdCBtZXNzYWdlID0gcmVzcG9uc2UubWVzc2FnZXNbMF07XG4gICAgdGhpcy5lbWl0dGVyLmxvZyhgTWVzc2FnZSBzZW50IHRvOiAgICR7bWVzc2FnZS50b31cblJlbWFpbmluZyBiYWxhbmNlOiAke21lc3NhZ2VbJ3JlbWFpbmluZy1iYWxhbmNlJ119IEVVUlxuTWVzc2FnZSBwcmljZTogICAgICR7bWVzc2FnZVsnbWVzc2FnZS1wcmljZSddfSBFVVJgKTtcbiAgfVxuXG4gIC8vIEpXVFxuXG4gIGdlbmVyYXRlSnd0KGVycm9yLCB0b2tlbikge1xuICAgIHRoaXMudmFsaWRhdG9yLnJlc3BvbnNlKGVycm9yLCB0b2tlbik7XG4gICAgdGhpcy5lbWl0dGVyLmxvZyhgJHt0b2tlbn1gLCBgSldUOiAgICR7dG9rZW59YCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUmVzcG9uc2U7XG4iXX0=